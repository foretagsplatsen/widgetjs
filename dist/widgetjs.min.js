/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,e){"function"==typeof define&&define.amd?define("widgetjs",["jquery","klassified"],e):t.widgetjs=e(t.$,t.klassified)}(this,function(t,e){var n,r,o;return function(t){function e(t,e){return w.call(t,e)}function i(t,e){var n,r,o,i,u,a,c,s,f,l,d,g=e&&e.split("/"),p=y.map,h=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(g=g.slice(0,g.length-1),t=t.split("/"),u=t.length-1,y.nodeIdCompat&&k.test(t[u])&&(t[u]=t[u].replace(k,"")),t=g.concat(t),f=0;f<t.length;f+=1)if(d=t[f],"."===d)t.splice(f,1),f-=1;else if(".."===d){if(1===f&&(".."===t[2]||".."===t[0]))break;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((g||h)&&p){for(n=t.split("/"),f=n.length;f>0;f-=1){if(r=n.slice(0,f).join("/"),g)for(l=g.length;l>0;l-=1)if(o=p[g.slice(0,l).join("/")],o&&(o=o[r])){i=o,a=f;break}if(i)break;!c&&h&&h[r]&&(c=h[r],s=f)}!i&&c&&(i=c,a=s),i&&(n.splice(0,a,i),t=n.join("/"))}return t}function u(e,n){return function(){return g.apply(t,T.call(arguments,0).concat([e,n]))}}function a(t){return function(e){return i(e,t)}}function c(t){return function(e){v[t]=e}}function s(n){if(e(m,n)){var r=m[n];delete m[n],b[n]=!0,d.apply(t,r)}if(!e(v,n)&&!e(b,n))throw new Error("No "+n);return v[n]}function f(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function l(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,g,p,h,v={},m={},y={},b={},w=Object.prototype.hasOwnProperty,T=[].slice,k=/\.js$/;p=function(t,e){var n,r=f(t),o=r[0];return t=r[1],o&&(o=i(o,e),n=s(o)),o?t=n&&n.normalize?n.normalize(t,a(e)):i(t,e):(t=i(t,e),r=f(t),o=r[0],t=r[1],o&&(n=s(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},h={require:function(t){return u(t)},exports:function(t){var e=v[t];return"undefined"!=typeof e?e:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:l(t)}}},d=function(n,r,o,i){var a,f,l,d,g,y,w=[],T=typeof o;if(i=i||n,"undefined"===T||"function"===T){for(r=!r.length&&o.length?["require","exports","module"]:r,g=0;g<r.length;g+=1)if(d=p(r[g],i),f=d.f,"require"===f)w[g]=h.require(n);else if("exports"===f)w[g]=h.exports(n),y=!0;else if("module"===f)a=w[g]=h.module(n);else if(e(v,f)||e(m,f)||e(b,f))w[g]=s(f);else{if(!d.p)throw new Error(n+" missing "+f);d.p.load(d.n,u(i,!0),c(f),{}),w[g]=v[f]}l=o?o.apply(v[n],w):void 0,n&&(a&&a.exports!==t&&a.exports!==v[n]?v[n]=a.exports:l===t&&y||(v[n]=l))}else n&&(v[n]=o)},n=r=g=function(e,n,r,o,i){if("string"==typeof e)return h[e]?h[e](n):s(p(e,n).f);if(!e.splice){if(y=e,y.deps&&g(y.deps,y.callback),!n)return;n.splice?(e=n,n=r,r=null):e=t}return n=n||function(){},"function"==typeof r&&(r=o,o=i),o?d(t,e,n,r):setTimeout(function(){d(t,e,n,r)},4),g},g.config=function(t){return g(t)},n._defined=v,o=function(t,n,r){n.splice||(r=n,n=[]),e(v,t)||e(m,t)||(m[t]=[t,n,r])},o.amd={jQuery:!0}}(),o("jquery",function(){return t}),o("klassified",function(){return e}),o("src/htmlCanvas",["jquery"],function(){function t(t){var r=e({element:t}),i={};return i.root=r,i.tag=function(t,n){var o=e({tag:t,children:n});return r.appendBrush(o),o},n.forEach(function(t){i[t]=function(){var e=Array.prototype.slice.call(arguments);return i.tag(t,e)}}),i.omit=function(){return o},i.render=function(){var t=Array.prototype.slice.call(arguments);r.render(t)},i.raw=function(t){r.raw(t)},i.renderNonBreaking=function(t){i.raw(t.replace(/\s/g,"&nbsp;"))},i}function e(e){function n(t){return document.createElement(t)}function u(t){if("undefined"==typeof t||null===t)throw new Error("cannot append null or undefined to brush");if(t!==o)if("object"==typeof t&&t.constructor===Array)for(var e=0;e<t.length;e++)u(t[e]);else"string"==typeof t?s(t):"function"==typeof t?f(t):"object"==typeof t&&t.appendToBrush?t.appendToBrush(d):"object"==typeof t?d.attr(t):jQuery(g).append(t)}function a(t){g.canHaveChildren!==!1?g.appendChild(t):g.text=g.text+t.innerHTML}function c(t){a(t.element())}function s(t){jQuery(g).append(document.createTextNode(t))}function f(e){var n=t(d);e(n)}function l(t){return"undefined"==typeof t||null===t?jQuery(document.createDocumentFragment()).get(0):"object"==typeof t&&t.asJQuery?t.asJQuery().get(0):jQuery(t).get(0)}var d={},g=e.tag?n(e.tag):l(e.element);if(!g)throw new Error("htmlTagBrush requires an element");return d.element=function(){return g},d.render=function(){for(var t=Array.prototype.slice.call(arguments),e=0;e<t.length;e++)u(t[e]);return d},d.appendToBrush=function(t){t.appendBrush(d)},d.appendBrush=c,d.html=function(t){return d.asJQuery().html(t),d},d.raw=function(t){return d.asJQuery().append(t),d},d.renderNonBreaking=function(t){d.raw(t.replace(/\s/g,"&nbsp;"))},d.on=function(t,e){return d.asJQuery().bind(t,e),d},i.forEach(function(t){d[t]=function(e){return d.on(t,e)}}),d.setAttribute=function(t,e){return e===o?d:(g.setAttribute(t,e),d)},r.forEach(function(t){d[t]=function(e){return d.setAttribute(t,e)}}),d.css=function(t,e){return"string"==typeof t?d.asJQuery().css(t,e):d.asJQuery().css(t),d},d.attr=function(t){for(var e in t)t.hasOwnProperty(e)&&("function"==typeof t[e]?d.on(e,t[e]):"klass"===e?d.addClass(t[e]):d.setAttribute(e,t[e]));return d},d.addClass=function(t){return d.asJQuery().addClass(t),d},d.removeClass=function(t){return d.asJQuery().removeClass(t),d},d.asJQuery=function(){return jQuery(d.element())},e.children&&u(e.children),d}var n="a abbr acronym address area article aside audio b bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn div dl dt em embed fieldset figcaption figure footer form frame frameset h1 h2 h3 h4 h5 h6 hr head header hgroup html i iframe img input ins kbd keygen label legend li link map mark meta meter nav noscript object ol optgroup option output p param pre progress q rp rtruby samp script section select small source span strong style sub summarysup table tbody td textarea tfoot th thead time title tr track tt ul varvideo wbr".split(" "),r="href for id media rel src style title type".split(" "),o={},i="blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error dragstart dragenter dragover dragleave drop dragend".split(" ");return t}),o("src/widget-extensions",[],function(){return{}}),o("src/router/url",["klassified"],function(t){function e(t){return t.split(o).filter(Boolean)}function n(t){return t.replace(/\?.*$/g,"")}function r(t){var e,n=/[^?]*\?(.*)$/g.exec(t),r={};return n&&n.length>=2&&n[1].split("&").forEach(function(t){e=t.split("="),r[e[0]]=e[1]}),r}var o="/",i=t.object.subclass(function(t,o){var i,u,a,c;o.initialize=function(t){o.super(t),i=t.rawUrl||"",u=n(i),a=r(i),c=e(u)},t.getPath=function(){return u},t.getQuery=function(){return a},t.getSegments=function(){return c},t.matchRoute=function(e){return e.matchUrl(t)},t.toString=function(){return i}});return i.build=function(t,e){if("undefined"==typeof t||null===t||"string"!=typeof t)throw"accepts only string paths";if(e){var n=decodeURIComponent(jQuery.param(e));if(n)return i({rawUrl:t+"?"+n})}return i({rawUrl:t})},i}),o("src/router/abstractSegment",["klassified"],function(t){var e=t.object.subclass(function(t,e){e.initialize=function(t){e.super(t),e.segmentString=t.segmentString,e.options=t.options||{}},t.match=function(t){return!1},t.getValue=function(t){return e.segmentString},t.isParameter=function(){return!1},t.isOptional=function(){return!1},t.toString=function(){return e.segmentString}});return e.class(function(t){t.match=function(t){return!1}}),e}),o("src/router/parameterSegment",["./abstractSegment"],function(t){function e(t){if("function"==typeof t)return t;if(t instanceof RegExp){var e=new RegExp(t);return function(t){return e.test(t)}}if("[object Array]"===Object.prototype.toString.call(t)){var n=t.map(function(t){return t.toLowerCase()});return function(t){var e=t.toLowerCase();return n.indexOf(e)!==-1}}return null}var n=t.subclass(function(t,n){n.initialize=function(t){n.super(t),n.name=n.segmentString.substr(1),n.constraints=n.options.constraints&&n.options.constraints[n.name]&&[n.options.constraints[n.name]]||[],n.validators=n.constraints.map(e).filter(Boolean)},t.getName=function(){return n.name},t.getValue=function(t){return t},t.isParameter=function(){return!0},t.match=function(e){return void 0!==e&&t.validate(e)},t.validate=function(t){return n.validators.every(function(e){return e(t)})},t.toString=function(){return"param("+t.getName()+")"}});return n.class(function(t){t.match=function(t){return"#"===t.substr(0,1)}}),n}),o("src/router/optionalParameterSegment",["./parameterSegment"],function(t){var e=t.subclass(function(t,e){e.initialize=function(t){e.super(t),e.defaultValue=e.options.defaults&&e.options.defaults[e.name]},t.getValue=function(t){return void 0===t?e.defaultValue:t},t.isOptional=function(){return!0},t.toString=function(){return"optional("+t.getName()+")"}});return e.class(function(t){t.match=function(t){return"?"===t.substr(0,1)}}),e}),o("src/router/staticSegment",["./abstractSegment"],function(t){var e=t.subclass(function(t,e){return t.match=function(e){return t.getValue()===e},t});return e.class(function(t){t.match=function(t){return["#","?"].indexOf(t[0])===-1}}),e}),o("src/router/routeFactory",["./abstractSegment","./parameterSegment","./optionalParameterSegment","./staticSegment"],function(t){function e(t,e){if(!t)return[];e=e||{};var o=t.split(r),i=o.map(Function.prototype.call,String.prototype.trim).filter(Boolean),u=i.map(function(t){return n(t,e)});return u}function n(e,n){n=n||{};for(var r=t.allSubclasses(),o=0;o<r.length;o++){var i=r[o];if(i.match(e))return i({segmentString:e,options:n})}return null}var r="/";return e}),o("src/events",[],function(){function t(t,e){function n(t){return console.warn("Using an event as a function is deprecated. Send register() to the event instead."),n.register(t)}function r(t){t=t||{};var e={},n=t.callback,r=t.event;return e.isBound=function(){return void 0!==r},e.unbind=function(){e.isBound()&&(r.unregister(e),r=void 0)},e.bind=function(t){e.unbind(),t&&(r=t)},e.execute=function(t){n&&n.apply(e,t)},e}function o(t){var e=r({callback:t,event:n});return i.push(e),e}e=e||{};var i=[];return n.on=function(t){return console.warn("Sending on() to an event is deprecated. Send register() instead."),n.register(t)},n.register=function(t){return o(t)},n.onceOn=function(t){return console.warn("Sending onceOn() to an event is deprecated. Send registerOnce() instead."),n.registerOnce(t)},n.registerOnce=function(t){var o=r({callback:function(){e.remove(o),t.apply(n,arguments)}});return i.push(o),o},n.off=function(t){console.warn("Sending off() to an event is deprecated. Send unregister() instead."),n.unregister(t)},n.unregister=function(t){e.remove(t)},n.trigger=function(){var t=Array.prototype.slice.call(arguments);i.forEach(function(e){e.execute(t)})},n.dispose=function(){i.slice().forEach(function(t){t.unbind()})},e.push=function(t){i.push(t),t.bind(n)},e.remove=function(t){i.splice(i.indexOf(t),1)},n}function e(){function e(e){return n(e)||r(t(),e),i[e]}function n(t){return void 0!==i[t]}function r(t,e){return u.push(t),e&&(i[e]=t),t}var o={},i={},u=[];return o.createEvent=function(e){return r(t(),e)},o.on=function(t,e){return console.warn("Sending on() to a category is deprecated. Send register() instead."),o.register(t,e)},o.register=function(t,n){return e(t).register(n)},o.off=function(t,e){return console.warn("Sending off() to a category is deprecated. Send unregister() instead."),o.unregister(t,e)},o.unregister=function(t,n){return e(t).unregister(n)},o.onceOn=function(t,e){return console.warn("Sending onceOn() to a category is deprecated. Send registerOnce() instead."),o.registerOnce(t,e)},o.registerOnce=function(t,n){return e(t).registerOnce(n)},o.trigger=function(t){var n=Array.prototype.slice.call(arguments,1),r=e(t);r.trigger.apply(o,n)},o.dispose=function(){u.forEach(function(t){t.dispose()}),i={},u=[]},o}var n=function(){var t={},n={};return t.register=function(t){if(n[t])throw"A event category is already registered for "+t;return n[t]=e(),n[t]},t.at=function(e){return n[e]||t.register(e),n[e]},t}();return n.eventCategory=e,n.eventhandler=e,n.event=t,n}),o("src/router/routeMatchResult",["klassified"],function(t){var e=t.object.subclass(function(t,e){function n(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);return n}var r,o,i,u,a;e.initialize=function(t){e.super(t),r=t.url,o=t.route,i=r&&r.getQuery&&r.getQuery()||{},u=t.values||{},a=n(u,i)},t.getRoute=function(){return o},t.getUrl=function(){return r},t.isMatch=function(){return!0},t.getRouteParameters=function(){return u},t.getQueryParameters=function(){return r.getQuery()},t.getParameters=function(){return a},t.getActionArguments=function(){var t=Object.keys(u).map(function(t){return u[t]});return t.push(r.getQuery()),t}});return e.class(function(t){t.routeNoMatchResult=function(){var e=t();return e.isMatch=function(){return!1},e}()}),e}),o("src/router/route",["./routeFactory","src/events","./routeMatchResult","./url","klassified","jquery"],function(t,e,n,r,o){function i(t){var e,n,r=[],o=Math.pow(2,t.length);for(n=1;n<o;n++){e=[];var i=t.length-1;do 0!==(n&1<<i)&&e.unshift(t[i]);while(i--);r.unshift(e)}return r}var u=o.object.subclass(function(o,u){function a(t,e){return e=e||l,!(t.length!==e.length&&!d)&&e.every(function(e,n){var r=t[n];return void 0!==r&&e.match(r)})}function c(t){var e=t.getSegments();if(a(e))return l;var n;for(n=0;n<g.length;n++)if(a(e,g[n]))return g[n];return null}function s(){var t=[];if(l.forEach(function(e,n){e.isOptional()&&t.push(n)}),t.length>15)throw new Error('Too many optional arguments. "'+t.length+'" optionals would generate  '+Math.pow(2,t.length)+" optional sequences.");var e=i(t);e.forEach(function(t){var e=l.slice();t.forEach(function(t,n){e.splice(t-n,1)}),g.push(e)})}function f(t,e){var r=e.getSegments(),i={};return l.forEach(function(e){if(e.isParameter()){var n=t.indexOf(e);n>=0?i[e.getName()]=e.getValue(r[n]):i[e.getName()]=e.getValue()}}),n({route:o,url:e,values:i})}var l,d,g;u.initialize=function(e){u.super(),l=t(e.pattern,e.options),d=e.options&&e.options.ignoreTrailingSegments||!1,g=[],s()},u.events=e.eventCategory(),o.matched=u.events.createEvent("matched"),o.onMatched=o.matched,o.on=u.events.register,o.matchUrl=function(t){var e=c(t);if(!e)return n.routeNoMatchResult;var r=f(e,t);return u.events.trigger("matched",r),r},o.expand=function(t){t=t||{};var e=[];l.forEach(function(n){var r;if(r=n.isParameter()?t[n.getName()]:n.getValue(),void 0!==r||!n.isOptional()){if(!n.match(r))throw new Error("Could not generate a valid URL");e.push(r)}});var n={};return Object.keys(t).forEach(function(e){o.hasParameter(e)||(n[e]=t[e],n[e]instanceof Array&&(n[e]=n[e].join(",")))}),r.build(e.join("/"),n).toString()},o.hasParameter=function(t){return l.some(function(e){return e.isParameter()&&e.getName()===t})},o.toString=function(){return"route("+l.join("/")+")"}});return u}),o("src/router/hashLocation",["jquery","src/events","./url","klassified"],function(t,e,n,r){var o=!("onhashchange"in window),i=25,u=r.object.subclass(function(r,u){function a(){return window.location.hash}function c(t){window.location.hash=t}function s(t){return"string"==typeof t&&(t=n({rawUrl:t})),"#!/"+t.toString()}function f(t){return n({rawUrl:t.replace(/^#!?[\/]?/,"")})}function l(t){t=t||a(),u.currentHash!==t&&(u.currentHash=t,u.history.push(u.currentHash)),r.changed.trigger(f(u.currentHash))}function d(){var t=a(),e=u.currentHash!==t;e&&l(t)}var g=null;u.currentHash=void 0,u.history=[],u.events=e.eventCategory(),r.changed=u.events.createEvent("changed"),r.onChanged=r.changed,r.setUrl=function(t){var e=s(t);c(e),l(e)},r.getUrl=function(){return f(a())},r.linkToUrl=function(t){return s(t)},r.back=function(t){r.isHistoryEmpty()?t&&c(s(t)):(u.history.pop(),c(u.history.pop())),l()},r.isHistoryEmpty=function(){return u.history.length<=1},r.start=function(){r.stop(),u.currentHash=a(),u.history=[u.currentHash],o?g=setInterval(d,i):t(window).bind("hashchange",d)},r.stop=function(){g&&(clearInterval(g),g=null),t(window).unbind("hashchange",d)}});return u}),o("src/router/router",["src/events","./route","./url","./hashLocation","klassified","jquery"],function(t,e,n,r,o){function i(){return i.instance||(i.instance=r()),i.instance}var u=o.object.subclass(function(r,o){function u(){var t=Array.prototype.slice.call(arguments),e={};return t.forEach(function(t){Object.keys(t).forEach(function(n){e[n]=t[n]})}),e}o.initialize=function(t){o.super(t),o.location=t.locationHandler||i(),o.routeTable=[],o.lastMatch=void 0,o.defaultParameters={},o.location.changed.register(function(){o.resolveUrl()})},o.events=t.eventCategory(),r.routeMatched=o.events.createEvent("routeMatched"),r.onRouteMatched=r.routeMatched,r.routeNotFound=o.events.createEvent("routeNotFound"),r.onRouteNotFound=r.routeNotFound,r.onResolveUrl=o.events.createEvent("resolveUrl"),r.on=o.events.register,r.resolveUrl=function(t){"string"==typeof t&&(t=n({rawUrl:t})),o.resolveUrl(t)},r.addRoute=function(t){t=t||{};var n=e({pattern:t.pattern,options:t});return t.action&&n.matched.register(function(e){t.action.apply(this,e.getActionArguments())}),n.name=t.name,n.fallThrough=t.fallThrough,n.priority=t.priority,o.addRoute(n),n},r.findRoute=function(t){for(var e=o.routeTable.length,n=0;n<e;n++){var r=o.routeTable[n];if(t(r))return r}return null},r.getRouteByName=function(t){return r.findRoute(function(e){return e.name&&e.name===t})},r.removeRoute=function(t){var e=o.routeTable.indexOf(t);if(e===-1)throw new Error("Route not in route table");o.routeTable.splice(e,1)},r.clear=function(){o.routeTable=[],o.lastMatch=void 0},r.pipeRoute=function(t,e){if(!t||!t.pattern)throw new Error("Route pattern required");var n=r.addRoute(t);return n.matched.register(function(t){e.resolveUrl(t.getUrl())}),n},r.pipeNotFound=function(t){return r.routeNotFound.register(function(e){t.resolveUrl(e)})},r.getUrl=function(){return o.location.getUrl()},r.linkTo=function(t,e,n){var i=r.getRouteByName(t);return i?o.location.linkToUrl(r.expand({routeName:i.name,parameters:e,excludeCurrentParameters:!n})):r.linkToPath(t,e)},r.linkToPath=function(t,e){return r.linkToUrl(n.build(t,e))},r.linkToUrl=function(t){return o.location.linkToUrl(t)},r.redirectTo=function(t,e,n){var i=r.getRouteByName(t);return i?o.location.setUrl(r.expand({routeName:i.name,parameters:e,excludeCurrentParameters:!n})):r.redirectToPath(t,e)},r.redirectToPath=function(t,e){return r.redirectToUrl(n.build(t,e))},r.redirectToUrl=function(t){return o.location.setUrl(t)},r.expand=function(t){var i,a=t.routeName,c=t.parameters||{},s=t.excludeCurrentParameters||!1;i=a?r.getRouteByName(a)||e():o.lastMatch?o.lastMatch.getRoute():e();var f=s?{}:r.getParameters(),l=u(f,c);Object.keys(o.defaultParameters).forEach(function(t){t in l||(l[t]="function"==typeof o.defaultParameters[t]?o.defaultParameters[t]():o.defaultParameters[t])});var d=i.expand(l);return n({rawUrl:d})},r.linkToParameters=function(t,e){return o.location.linkToUrl(r.expand({parameters:t,excludeCurrentParameters:e}))},r.setParameters=function(t,e){r.redirectToUrl(r.expand({parameters:t,excludeCurrentParameters:e}))},r.getParameters=function(){return o.lastMatch?o.lastMatch.getParameters():o.location.getUrl().getQuery()},r.getParameter=function(t){var e=r.getParameters();return e[t]},r.setDefaultParameter=function(t,e){o.defaultParameters[t]=e},r.back=function(t){return o.location.back(t)},r.isHistoryEmpty=function(){return o.location.isHistoryEmpty()},r.start=function(){o.location.start(),o.resolveUrl()},r.stop=function(){o.location.stop()},o.resolveUrl=function(t){var e=void 0===t?o.location.getUrl():t;r.onResolveUrl.trigger(e);var n=0;o.routeTable.some(function(t){var i=e.matchRoute(t);return!(!i.isMatch()||(o.lastMatch=i,n++,r.routeMatched.trigger(i),void 0!==t.fallThrough&&t.fallThrough!==!1))||null}),0===n&&r.routeNotFound.trigger(e.toString())},o.addRoute=function(t){var e=o.routeTable.length;if(void 0!==t.priority){do--e;while(o.routeTable[e]&&(void 0===o.routeTable[e].priority||t.priority<o.routeTable[e].priority));e+=1}o.routeTable.splice(e,0,t)}});return u}),o("src/router",["./router/url","./router/route","./router/router"],function(t,e,n){var r=n();return{url:t,route:e,router:n,getRouter:function(){return r},setRouter:function(t){r=t}}}),o("src/widget",["klassified","./widget-extensions","./router","./events","./htmlCanvas","jquery"],function(t,e,n,r,o){function i(){return!!c.get()}function u(t,e){var n=c.get();try{c.set(e),t()}finally{c.set(n)}}var a=function(){var t={},e=0;return t.newId=function(){return e+=1,e.toString()},t}(),c=function(){var t;return{get:function(){return t},set:function(e){t=e}}}(),s=t.object.subclass(function(t,s){function f(e){s.withChildrenRegistration(function(){t.renderOn(e)})}var l,d;s.initialize=function(t){s.super(t),d=t.id||a.newId(),s.inUpdateTransaction=!1,l=[]},s.initializeSubwidgets=function(t){},s.postInitialize=function(t){s.initializeSubwidgets(t)},s.events=r.eventCategory(),t.onAttach=s.events.createEvent(),t.onDetach=s.events.createEvent(),t.getId=function(){return d},t.id=t.getId,t.dispose=function(){l.forEach(function(t){t.dispose()}),s.dispose(),s.events.dispose()},t.willDetach=function(){l.forEach(function(t){t.willDetach()}),s.willDetach(),t.onDetach.trigger()},t.appendTo=function(t){s.withAttachHooks(function(){f(o(t))})},t.replace=function(t){s.withAttachHooks(function(){var e=o(t);e.root.asJQuery().empty(),f(e)})},t.asJQuery=function(){return jQuery("#"+t.getId())},t.isRendered=function(){return t.asJQuery().length>0},t.appendToBrush=function(t){s.withAttachHooks(function(){f(o(t.asJQuery()))})},t.triggerWillAttach=function(){s.willAttach(),l.forEach(function(t){t.triggerWillAttach()})},t.triggerDidAttach=function(){s.didAttach(),l.forEach(function(t){t.triggerDidAttach()}),t.onAttach.trigger()},s.withAttachHooks=function(e){var n=i();n||t.triggerWillAttach(),e(),n||t.triggerDidAttach()},s.createEvent=function(e){t[e]=s.events.createEvent()},s.createEvents=function(){var t=Array.prototype.slice.apply(arguments);t.forEach(s.createEvent)},t.on=s.events.on,t.onceOn=s.events.onceOn,t.off=s.events.off,t.register=s.events.register,t.registerOnce=s.events.registerOnce,t.unregister=s.events.unregister,t.trigger=s.events.trigger,s.nextId=function(){return a.newId()},s.dispose=function(){},s.router=n.getRouter(),s.linkTo=s.router.linkTo,s.linkToPath=s.router.linkToPath,s.linkToUrl=s.router.linkToUrl,s.redirectTo=s.router.redirectTo,s.redirectToPath=s.router.redirectToPath,s.redirectToUrl=s.router.redirectToUrl,s.getParameters=s.router.getParameters,s.getParameter=s.router.getParameter,s.setParameters=s.router.setParameters,t.renderOn=function(e){s.renderRootOn(e).render(t.renderContentOn)},s.withChildrenRegistration=function(e){var n=c.get();n&&n.registerChild(t),u(function(){l=[],e()},t)},t.registerChild=function(t){l.push(t)},s.renderRootOn=function(t){return t.tag("widgetjs-widget").id(d)},t.renderContentOn=function(t){return s.subclassResponsibility()},s.willAttach=function(){},s.didAttach=function(){},s.willDetach=function(){},s.willUpdate=function(){},t.update=function(){!s.inUpdateTransaction&&t.isRendered()&&(s.willUpdate(),s.withAttachHooks(function(){var e=o();f(e),t.asJQuery().replaceWith(e.root.element)}))},t.withinTransaction=function(t,e){if(s.inUpdateTransaction)t();else try{s.inUpdateTransaction=!0,t()}finally{s.inUpdateTransaction=!1,e&&e()}},t.withUpdate=function(e){t.withinTransaction(e,t.update)},t.withNoUpdate=function(e){t.withinTransaction(e)};for(var g in e)e.hasOwnProperty(g)&&(s[g]=e[g]);return t});return s}),o("src/widgetjs",["./htmlCanvas","./widget","./widget-extensions","./router","./events"],function(t,e,n,r,o){return{htmlCanvas:t,widget:e,ext:n,router:r,events:o}}),r(["src/widgetjs"]),r("widgetjs")});